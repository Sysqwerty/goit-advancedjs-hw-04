{"version":3,"file":"commonHelpers.js","sources":["../src/js/constants.js","../src/js/api.js","../src/js/index.js"],"sourcesContent":["const DEFAULT_PER_PAGE = 40;\n\nconst controls = {\n  page: 1,\n  per_page: DEFAULT_PER_PAGE,\n  receivedHits: 0,\n  searchQuery: null,\n  isLoading: false,\n  isScrollListenerAdded: false,\n};\n\nconst selectors = {\n  form: document.querySelector('.search-form'),\n  gallery: document.querySelector('.gallery'),\n  loader: document.querySelector('.loader'),\n  submitButton: document.querySelector('[type=\"submit\"]'),\n};\n\nconst keys = {\n  API_KEY: '44202133-14fac6110a8eccaaec992feaf',\n  AXIOS_KEY:\n    'live_nOdnL3Dj9jjF4zVLjteozldoqmiVUxxCRsrlPoRVyonLQDm4DFuaUNiaRzafsnXC',\n};\n\nconst BASE_URL = 'https://pixabay.com/api/';\n\nexport { controls, selectors, keys, BASE_URL, DEFAULT_PER_PAGE };\n","import axios from 'axios';\nimport { controls, keys, BASE_URL } from './constants';\n\naxios.defaults.headers.common['x-api-key'] = keys.AXIOS_KEY;\naxios.defaults.headers = ['Access-Control-Allow-Origin'];\n\nexport async function fetchHits() {\n  const queryParams = new URLSearchParams({\n    key: keys.API_KEY,\n    q: controls.searchQuery,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: controls.per_page,\n    page: controls.page,\n  });\n\n  const response = await axios.get(`${BASE_URL}?${queryParams.toString()}`);\n\n  const data = await response.data;\n  console.log('data:\\n', data);\n  return data;\n}\n","import iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport { fetchHits } from './api';\nimport { selectors, controls, DEFAULT_PER_PAGE } from './constants';\n\nconst gallery = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\ngallery.on('error.simplelightbox', function (e) {\n  console.log(e);\n});\n\nselectors.form.addEventListener('submit', onFormSubmit);\n\nfunction onScroll() {\n  if (\n    window.scrollY + window.innerHeight >=\n    document.documentElement.scrollHeight - 50\n  ) {\n    loadData();\n  }\n}\n\nasync function onFormSubmit(evt) {\n  evt.preventDefault();\n\n  if (!controls.isScrollListenerAdded) {\n    window.addEventListener('scroll', onScroll);\n    controls.isScrollListenerAdded = true;\n  }\n\n  const formData = new FormData(evt.currentTarget);\n  controls.searchQuery = formData.get('searchQuery');\n\n  if (!controls.searchQuery) {\n    showToast('Please enter a search query.', 'error');\n    selectors.loader.classList.add('hide');\n    controls.isLoading = false;\n    return;\n  }\n\n  controls.page = 1;\n  controls.receivedHits = 0;\n  controls.per_page = DEFAULT_PER_PAGE;\n\n  selectors.gallery.innerHTML = '';\n  selectors.loader.classList.remove('hide');\n  selectors.form.reset();\n\n  await loadData(true);\n}\n\n/**\n * Loads a data from an API call and renders images\n * @param {boolean} firstRender - is it the first call of the method\n */\nasync function loadData(firstRender = false) {\n  if (controls.isLoading) return;\n  controls.isLoading = true;\n\n  selectors.loader.classList.remove('hide');\n  selectors.submitButton.disabled = true;\n\n  try {\n    const { totalHits, hits } = await fetchHits();\n\n    if (!totalHits || !hits?.length) {\n      showToast(\n        'Sorry, there are no images matching your search query. Please try again.',\n        'error'\n      );\n      return;\n    }\n\n    renderImages(hits);\n    gallery.refresh();\n\n    controls.page++;\n    controls.per_page = Math.min(\n      totalHits - controls.receivedHits,\n      DEFAULT_PER_PAGE\n    );\n    controls.receivedHits += hits.length;\n\n    if (firstRender) {\n      showToast(`Hooray! We found ${totalHits} images.`, 'success');\n    } else {\n      const { height: cardHeight } =\n        selectors.gallery.firstElementChild.getBoundingClientRect();\n\n      window.scrollBy({\n        top: cardHeight * 2,\n        behavior: 'smooth',\n      });\n    }\n\n    if (firstRender && controls.per_page >= totalHits) {\n      window.removeEventListener('scroll', onScroll);\n      controls.isScrollListenerAdded = false;\n    }\n\n    if (controls.receivedHits >= totalHits && !firstRender) {\n      showToast(\n        `We're sorry, but you've reached the end of search results.`,\n        'info'\n      );\n      window.removeEventListener('scroll', onScroll);\n      controls.isScrollListenerAdded = false;\n    }\n  } catch (error) {\n    showToast('Error fetching data. Please try again.', 'error');\n  } finally {\n    selectors.loader.classList.add('hide');\n    selectors.submitButton.disabled = false;\n    controls.isLoading = false;\n  }\n}\n\n/**\n * Renders images from the array\n * @param {Array} images\n */\nfunction renderImages(images) {\n  const markup = images\n    .map(\n      ({\n        largeImageURL,\n        webformatURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `\n      <div class=\"photo-card\">\n        <a href=\"${largeImageURL}\" class=\"card-link\">\n          <img src=\"${webformatURL}\" alt=\"${tags}\" class=\"card-image\" loading=\"lazy\" />\n        </a>\n        <div class=\"info\">\n          <p class=\"info-item\"><b>Likes</b> ${likes}</p>\n          <p class=\"info-item\"><b>Views</b> ${views}</p>\n          <p class=\"info-item\"><b>Comments</b> ${comments}</p>\n          <p class=\"info-item\"><b>Downloads</b> ${downloads}</p>\n        </div>\n      </div>\n    `\n    )\n    .join('');\n\n  selectors.gallery.insertAdjacentHTML('beforeend', markup);\n}\n\n/**\n * Shows toast with different types and dynamic message\n * @param {string} message    - toast message\n * @param {string} type       - error, success, info, warning etc.\n * @param {number} timeoutSec - error, success, info, warning etc.\n */\nfunction showToast(message, type = 'info', timeoutSec = 3) {\n  iziToast[type]({\n    message: message,\n    position: 'topRight',\n    timeout: timeoutSec * 1000,\n  });\n}\n"],"names":["DEFAULT_PER_PAGE","controls","selectors","keys","BASE_URL","axios","fetchHits","queryParams","data","gallery","SimpleLightbox","e","onFormSubmit","onScroll","loadData","evt","formData","showToast","firstRender","totalHits","hits","renderImages","cardHeight","images","markup","largeImageURL","webformatURL","tags","likes","views","comments","downloads","message","type","timeoutSec","iziToast"],"mappings":"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"}